<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=yes">
  <title>Market Update Bot ¬∑ chatgpt dark</title>
  <!-- Font Awesome 6 (free) -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
  <style>
    /* CHATGPT-INSPIRED DARK THEME ‚Äî black & gray, minimal */
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: system-ui, -apple-system, 'Segoe UI', Roboto, 'Helvetica Neue', sans-serif;
    }

    body {
      background: #000000;  /* pure black base */
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      color: #e5e5e5;
    }

    /* main app container ‚Äì solid dark gray, flat */
    .app {
      max-width: 480px;
      width: 100%;
      margin: 0 auto;
      background: #171717;  /* dark gray like chatGPT panels */
      border-radius: 28px 28px 0 0;
      box-shadow: 0 10px 30px rgba(0,0,0,0.8);
      flex: 1;
      display: flex;
      flex-direction: column;
      margin-top: 8px;
      margin-bottom: 8px;
      overflow: hidden;
      border: 1px solid #2d2d2d;
    }

    /* header ‚Äì solid black */
    .header {
      padding: 18px 20px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      background: #0a0a0a;
      border-bottom: 1px solid #2d2d2d;
    }

    .header h1 {
      font-size: 1.5rem;
      font-weight: 600;
      color: #ffffff;
      letter-spacing: -0.02em;
    }

    .menu-icon {
      font-size: 1.8rem;
      color: #a0a0a0;
      cursor: pointer;
      transition: 0.2s;
      width: 40px;
      height: 40px;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 12px;
      background: #1e1e1e;
      border: 1px solid #333;
    }

    .menu-icon:hover { background: #2d2d2d; color: #fff; }

    /* banner ‚Äì neutral gradient, no glass */
    .banner {
      margin: 16px 20px 8px 20px;
      background: #2a2a2a;
      border-radius: 24px;
      height: 100px;
      background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 200 100" width="200" height="100"><rect width="200" height="100" fill="%23333"/><text x="20" y="55" font-family="system-ui" font-weight="500" font-size="16" fill="%23ccc">glider-app.pages.dev</text></svg>');
      background-size: cover;
      background-position: center;
      border: 1px solid #3d3d3d;
      cursor: pointer;
      transition: transform 0.15s;
    }
    .banner:active { transform: scale(0.98); }

    /* chat area ‚Äì scroll */
    .chat-container {
      flex: 1;
      padding: 16px 16px 0 16px;
      display: flex;
      flex-direction: column;
      gap: 16px;
      overflow-y: auto;
      max-height: 460px;
      scrollbar-width: thin;
      scrollbar-color: #4a4a4a #1a1a1a;
    }
    .chat-container::-webkit-scrollbar { width: 4px; }
    .chat-container::-webkit-scrollbar-track { background: #1a1a1a; }
    .chat-container::-webkit-scrollbar-thumb { background: #4a4a4a; border-radius: 8px; }

    .message {
      display: flex;
      flex-direction: column;
    }
    .message.bot { align-items: flex-start; }
    .message.user { align-items: flex-end; }

    .bubble {
      max-width: 85%;
      padding: 14px 18px;
      border-radius: 22px;
      background: #2d2d2d;   /* chatGPT assistant bubble */
      border: 1px solid #3d3d3d;
      font-size: 0.95rem;
      line-height: 1.5;
      color: #ececec;
      box-shadow: 0 1px 2px rgba(0,0,0,0.5);
    }

    .user .bubble {
      background: #1e1e1e;   /* user bubble ‚Äì slightly darker */
      border: 1px solid #4a4a4a;
      color: #ffffff;
    }

    /* analysis card */
    .analysis-grid {
      display: flex;
      flex-direction: column;
      gap: 6px;
      margin-top: 4px;
    }
    .row {
      display: flex;
      justify-content: space-between;
      border-bottom: 1px dashed #3d3d3d;
      padding-bottom: 4px;
    }
    .row .label { opacity: 0.7; font-weight: 400; }
    .row .value { font-weight: 600; }
    .signal-badge {
      display: inline-block;
      padding: 4px 12px;
      border-radius: 30px;
      font-size: 0.85rem;
      font-weight: 600;
    }
    .buy { background: #0f7b5a; color: white; }    /* muted green */
    .sell { background: #b33e3e; color: white; }    /* muted red */
    .hold { background: #9e7500; color: white; }    /* muted amber */
    .risk-low { color: #10a37f; }      /* chatGPT green */
    .risk-medium { color: #d97706; }
    .risk-high { color: #dc2626; }

    /* examples chips ‚Äì subtle outline */
    .examples {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      padding: 8px 16px 0 16px;
    }
    .chip {
      background: #1e1e1e;
      border: 1px solid #3d3d3d;
      color: #cccccc;
      padding: 8px 14px;
      border-radius: 40px;
      font-size: 0.85rem;
      font-weight: 500;
      cursor: pointer;
      transition: 0.1s;
    }
    .chip:hover { background: #2d2d2d; border-color: #5a5a5a; color: white; }

    /* input area ‚Äì black, solid */
    .input-area {
      display: flex;
      align-items: center;
      gap: 8px;
      padding: 16px 20px 20px 20px;
      background: #0d0d0d;
      border-top: 1px solid #2d2d2d;
    }
    .input-area input {
      flex: 1;
      background: #1e1e1e;
      border: 1px solid #3d3d3d;
      border-radius: 40px;
      padding: 16px 20px;
      font-size: 1rem;
      color: #fff;
      outline: none;
    }
    .input-area input::placeholder { color: #5f5f5f; }
    .input-area button {
      background: #2d2d2d;
      border: 1px solid #4a4a4a;
      width: 56px;
      height: 56px;
      border-radius: 56px;
      color: #e0e0e0;
      font-size: 1.5rem;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: 0.15s;
    }
    .input-area button:hover { background: #3d3d3d; color: white; border-color: #6a6a6a; }

    /* footer ‚Äì solid black */
    .footer {
      background: #0a0a0a;
      border-top: 1px solid #2d2d2d;
      padding: 14px 20px;
      display: flex;
      flex-direction: column;
      gap: 12px;
    }
    .footer-ad {
      width: 100%;
      height: 60px;
      background: #1e1e1e;
      border-radius: 16px;
      background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 200 50" width="200" height="50"><rect width="200" height="50" fill="%23222"/><text x="20" y="30" font-family="system-ui" font-size="14" fill="%23999">footer-ad.jpg  |  premium space</text></svg>');
      background-size: cover;
      border: 1px solid #3d3d3d;
    }
    .disclaimer {
      font-size: 0.7rem;
      color: #888;
      text-align: center;
    }

    /* SIDEBAR ‚Äì chatgpt style drawer */
    .sidebar-overlay {
      position: fixed;
      top: 0; left: 0; width: 100%; height: 100%;
      background: rgba(0,0,0,0.7);
      backdrop-filter: none;
      z-index: 999;
      visibility: hidden;
      opacity: 0;
      transition: 0.2s ease;
    }
    .sidebar {
      position: fixed;
      top: 0; left: -300px;
      width: 280px;
      height: 100%;
      background: #0d0d0d;
      border-right: 1px solid #2d2d2d;
      z-index: 1000;
      padding: 32px 20px;
      transition: left 0.25s cubic-bezier(0.4, 0, 0.2, 1);
      box-shadow: 5px 0 20px rgba(0,0,0,0.8);
      display: flex;
      flex-direction: column;
      gap: 28px;
    }
    .sidebar.open { left: 0; }
    .sidebar-overlay.open {
      visibility: visible;
      opacity: 1;
    }
    .sidebar .close-icon {
      color: #aaa;
      font-size: 1.8rem;
      align-self: flex-end;
      cursor: pointer;
    }
    .sidebar-btn {
      background: transparent;
      border: 1px solid #4a4a4a;
      color: #ddd;
      padding: 16px;
      border-radius: 40px;
      font-size: 1.1rem;
      font-weight: 500;
      width: 100%;
      cursor: pointer;
      transition: 0.2s;
    }
    .sidebar-btn:hover {
      background: #2d2d2d;
      border-color: #6a6a6a;
      color: white;
    }
    .hidden-content {
      margin-top: 12px;
      padding: 16px;
      background: #1e1e1e;
      border-radius: 20px;
      border-left: 4px solid #10a37f;  /* chatgpt green accent */
      color: #10a37f;
      font-size: 1.2rem;
      font-weight: 500;
      display: none;
    }
    .hidden-content.show { display: block; }
  </style>
</head>
<body>
<div class="app">
  <!-- header -->
  <div class="header">
    <h1>Market Update Bot</h1>
    <div class="menu-icon" id="menuToggle"><i class="fas fa-bars"></i></div>
  </div>

  <!-- banner (clickable) -->
  <div class="banner" id="bannerClick" title="Open glider-app.pages.dev"></div>

  <!-- example chips -->
  <div class="examples" id="exampleChips">
    <span class="chip" data-symbol="TCS">TCS</span>
    <span class="chip" data-symbol="INFY">INFY</span>
    <span class="chip" data-symbol="RELIANCE">RELIANCE</span>
    <span class="chip" data-symbol="HDFCBANK">HDFCBANK</span>
  </div>

  <!-- chat messages area -->
  <div class="chat-container" id="chatContainer">
    <div class="message bot">
      <div class="bubble">üëã Enter an NSE stock symbol (e.g., TCS, INFY) to get live price, signal & risk.</div>
    </div>
  </div>

  <!-- input field -->
  <div class="input-area">
    <input type="text" id="symbolInput" placeholder="e.g. TCS" autocomplete="off" autocapitalize="characters">
    <button id="sendBtn"><i class="fas fa-arrow-up"></i></button>
  </div>

  <!-- footer with static banner ad -->
  <div class="footer">
    <div class="footer-ad"></div>
    <div class="disclaimer">Trade at your own risk. The developer is not responsible for any financial loss.</div>
  </div>
</div>

<!-- sidebar (drawer) -->
<div class="sidebar-overlay" id="sidebarOverlay"></div>
<div class="sidebar" id="sidebar">
  <div class="close-icon" id="closeSidebar"><i class="fas fa-times"></i></div>
  <button class="sidebar-btn" id="followDevBtn">Follow Developer <i class="fas fa-heart" style="margin-left: 8px; color: #10a37f;"></i></button>
  <div class="hidden-content" id="hiddenInsta">Instagram @_fayizeeyy</div>
</div>

<!-- javascript (same as before, but adapted) -->
<script>
  (function() {
    // DOM elements
    const menuToggle = document.getElementById('menuToggle');
    const sidebar = document.getElementById('sidebar');
    const overlay = document.getElementById('sidebarOverlay');
    const closeSidebar = document.getElementById('closeSidebar');
    const followBtn = document.getElementById('followDevBtn');
    const hiddenInsta = document.getElementById('hiddenInsta');
    const banner = document.getElementById('bannerClick');
    const chatContainer = document.getElementById('chatContainer');
    const symbolInput = document.getElementById('symbolInput');
    const sendBtn = document.getElementById('sendBtn');
    const chips = document.querySelectorAll('.chip');

    // --- sidebar logic ---
    function openSidebar() {
      sidebar.classList.add('open');
      overlay.classList.add('open');
    }
    function closeSidebarFunc() {
      sidebar.classList.remove('open');
      overlay.classList.remove('open');
    }
    menuToggle.addEventListener('click', openSidebar);
    closeSidebar.addEventListener('click', closeSidebarFunc);
    overlay.addEventListener('click', closeSidebarFunc);

    // follow button reveals hidden insta
    followBtn.addEventListener('click', function() {
      hiddenInsta.classList.toggle('show');
    });

    // banner click open external
    banner.addEventListener('click', function() {
      window.open('https://glider-app.pages.dev', '_blank');
    });

    // --- helper: add message to chat ---
    function addMessage(text, isUser = false) {
      const msgDiv = document.createElement('div');
      msgDiv.classList.add('message');
      msgDiv.classList.add(isUser ? 'user' : 'bot');
      const bubble = document.createElement('div');
      bubble.classList.add('bubble');
      bubble.innerHTML = text;
      msgDiv.appendChild(bubble);
      chatContainer.appendChild(msgDiv);
      chatContainer.scrollTop = chatContainer.scrollHeight;
      return msgDiv;
    }

    // --- show typing indicator ---
    function showTyping() {
      const msgDiv = document.createElement('div');
      msgDiv.classList.add('message', 'bot');
      msgDiv.id = 'typingIndicator';
      const bubble = document.createElement('div');
      bubble.classList.add('bubble');
      bubble.innerHTML = 'Checking... <i class="fas fa-spinner fa-pulse"></i>';
      msgDiv.appendChild(bubble);
      chatContainer.appendChild(msgDiv);
      chatContainer.scrollTop = chatContainer.scrollHeight;
      return msgDiv;
    }

    // --- remove typing indicator ---
    function removeTyping() {
      const typing = document.getElementById('typingIndicator');
      if (typing) typing.remove();
    }

    // --- compute signal & risk based on spec ---
    function getSignal(price, open, changePercent) {
      if (price > open && changePercent > 1.0) return 'BUY';
      else if (price < open && changePercent < -1.0) return 'SELL';
      else return 'HOLD';
    }
    function getRisk(changePercent) {
      const absChange = Math.abs(changePercent);
      if (absChange <= 2.0) return { level: 'LOW', class: 'risk-low' };
      else if (absChange > 2.0 && absChange <= 4.0) return { level: 'MEDIUM', class: 'risk-medium' };
      else return { level: 'HIGH', class: 'risk-high' };
    }

    // --- format market state ---
    function formatMarketState(state) {
      if (!state) return 'N/A';
      if (state === 'REGULAR') return 'üü¢ Open (Regular)';
      if (state === 'PRE') return 'üü° Pre-market';
      if (state === 'POST') return 'üü° After-hours';
      return 'üî¥ Closed';
    }

    // --- fetch stock data from Yahoo via allorigins proxy ---
    async function fetchStockData(symbolRaw) {
      const symbol = symbolRaw.trim().toUpperCase();
      if (!symbol) return;

      // user message
      addMessage(symbol, true);

      // show typing
      showTyping();

      try {
        const yahooUrl = `https://query1.finance.yahoo.com/v7/finance/quote?symbols=${symbol}.NS`;
        const proxyUrl = `https://api.allorigins.win/raw?url=${encodeURIComponent(yahooUrl)}`;

        const response = await fetch(proxyUrl);
        if (!response.ok) throw new Error('Network issue');

        const textData = await response.text(); 
        const json = JSON.parse(textData);

        const quote = json.quoteResponse?.result?.[0];
        if (!quote) throw new Error('Symbol not found on NSE');

        // extract needed fields
        const company = quote.longName || quote.shortName || symbol;
        const price = quote.regularMarketPrice;
        const change = quote.regularMarketChangePercent;
        const open = quote.regularMarketOpen || price; 
        const dayHigh = quote.regularMarketDayHigh;
        const dayLow = quote.regularMarketDayLow;
        const marketState = quote.marketState || 'CLOSED';

        // signal & risk
        const signal = getSignal(price, open, change);
        const riskObj = getRisk(change);
        const riskText = riskObj.level;

        // remove typing and show analysis
        removeTyping();

        const analysisHTML = `
          <div style="font-weight:600; margin-bottom:8px;">üìà ${company}</div>
          <div class="analysis-grid">
            <div class="row"><span class="label">üí∞ Live price</span><span class="value">‚Çπ${price?.toFixed(2) ?? 'N/A'}</span></div>
            <div class="row"><span class="label">üìä % change</span><span class="value" style="color:${change >= 0 ? '#10a37f' : '#ef4444'};">${change?.toFixed(2) ?? 'N/A'}%</span></div>
            <div class="row"><span class="label">üìà Day high</span><span class="value">‚Çπ${dayHigh?.toFixed(2) ?? 'N/A'}</span></div>
            <div class="row"><span class="label">üìâ Day low</span><span class="value">‚Çπ${dayLow?.toFixed(2) ?? 'N/A'}</span></div>
            <div class="row"><span class="label">üö¶ Signal</span><span class="value"><span class="signal-badge ${signal.toLowerCase()}">${signal}</span></span></div>
            <div class="row"><span class="label">‚ö†Ô∏è Risk level</span><span class="value ${riskObj.class}">${riskText}</span></div>
            <div class="row"><span class="label">üïí Market</span><span class="value">${formatMarketState(marketState)}</span></div>
          </div>
        `;
        addMessage(analysisHTML, false);
      } catch (err) {
        removeTyping();
        addMessage(`‚ùå Error: ${err.message}. Please check symbol or try again.`, false);
      }
    }

    // --- send button ---
    sendBtn.addEventListener('click', () => {
      const sym = symbolInput.value.trim();
      if (sym) {
        fetchStockData(sym);
        symbolInput.value = '';
      }
    });

    symbolInput.addEventListener('keypress', (e) => {
      if (e.key === 'Enter') {
        e.preventDefault();
        sendBtn.click();
      }
    });

    chips.forEach(chip => {
      chip.addEventListener('click', () => {
        const sym = chip.getAttribute('data-symbol');
        symbolInput.value = sym;
        fetchStockData(sym);
      });
    });

    // auto uppercase
    symbolInput.addEventListener('input', function() {
      this.value = this.value.toUpperCase().replace(/[^A-Z.]/g, '');
    });
  })();
</script>
</body>
</html>
